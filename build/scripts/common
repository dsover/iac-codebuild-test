#!/usr/bin/env bash

# exit when any command fails
set -e
export ENVIRONMENT=demo

cd ./application-infrastructure/

WORKING_DIR=$(pwd)

ORG="cnn"
TEAM="zion"
APPLICATION="iac-codebuild-test"

#if aws sts get-caller-identity >/dev/null; then
#    echo "Credentials are up-to-date."
#else
#    echo "[ERROR] Credentials are not up-to-date."
#    exit 1
#fi

echo "Org: \"${ORG}\""
echo "Team: \"${TEAM}\""
echo "Application: \"${APPLICATION}\""
echo "Environment: \"${ENVIRONMENT}\""
WORKSPACE="${ORG}:${TEAM}:${APPLICATION}:${ENVIRONMENT}"
echo $WORKSPACE
pwd
terraform init
terraform workspace select "$WORKSPACE" || terraform workspace new "$WORKSPACE"
echo "Workspace: \"$(terraform workspace show)\""
